{
    "variables": {
    "dockerlogin": "{{env `DOCKERLOGIN`}}",
    "dockerpass": "{{env `DOCKERPASS`}}"
    },

    "builders": [{
        "type": "docker",
        "image": "python",
        "commit": true,
        "changes": [
            "EXPOSE 5432",
            "USER root",
            "CMD [\"python\", \"server.py\"]",
            "ENTRYPOINT [\"\"]"
        ]
    }],

    "provisioners": [
        {
        "type": "ansible",
        "user": "root",
        "playbook_file": "ansible-pl.yml"
        }
    ],

    "post-processors": [
      [
        {
          "type": "docker-tag",
          "repository": "valery/echo-server-python",
          "tag": "0.1"
        },
        {
          "type": "docker-push",
          "login": true,
          "login_username": "{{ user `dockerlogin` }}",
          "login_password": "{{ user `dockerpass` }}"
        }
      ]
    ]
}